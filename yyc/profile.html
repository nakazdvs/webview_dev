<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>モーフィング</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="robots" content="noindex, nofollow">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.6/css/swiper.min.css">
<link rel="stylesheet" href="./css/photoswipe.css">
<link rel="stylesheet" href="./css/default-skin.css">
<link href="./css/profile.css" rel="stylesheet">
</head>
<body class="is_ios_safari">

<div id="container">
<main id="main">

  <header id="header">
    <div id="header_bar">
      <div class="back" id="back"></div>
      <div class="menu" id="show"></div>
    </div>
    <div class="menu_list" :class="changeOpen" id="menu"><ul>
    <li><a href="http://livedoor.com">my</a></li>
    <li><a href="http://livedoor.com">message</a></li>
    <li><a href="http://livedoor.com">search</a></li>
    <li><a href="http://livedoor.com">bbs</a></li>
    </ul></div>
  </header>

  <div id="wrap">
  <div id="mainPhotoBox" style="background-image:url(./img/profile.jpg);"></div>
  <div class="subphotos" data-pswp>
    <div class="box"><a href="./img/phsw/img01.jpg" target="_blank"><img src="./img/phsw/img01-thumb.jpg" alt=""></a></div>
    <div class="box"><a href="./img/phsw/img02.jpg" target="_blank"><img src="./img/phsw/img02-thumb.jpg" alt=""></a></div>
    <div class="box"><a href="./img/phsw/img03.jpg" target="_blank"><img src="./img/phsw/img03-thumb.jpg" alt=""></a></div>
    <div class="box"><a href="./img/phsw/img04.jpg" target="_blank"><img src="./img/phsw/img04-thumb.jpg" alt=""></a></div>
  </div>
  <div id="mainPhotoBox" style="background-image:url(./img/profile.jpg);"></div>

  <div id="bbsStatusWrap" v-scroll="reachScroll">
    <div class="statusBody is_play">
      <dl class="body">
        <dt class="label"><strong>今から遊べる人</strong></dt>
        <dd class="text"><b>今日、飲みに行きませんか？</b></dd>
        <dd class="area">東京 渋谷 池袋 新宿</dd>
      </dl>
      <div class="distance" id="distanceCircle"><distance-circle ref="circle" last="18"></distance-circle><span class="baseCircle" data-distance="18"></span></div>
    </div>
  </div>
  <div id="mainPhotoBox" style="background-image:url(./img/profile.jpg);"></div>
  <div id="mainPhotoBox" style="background-image:url(./img/profile.jpg);"></div>
  </div>

</main>

<div id="fixedDrawer" :class="changeSetRiseup">
  <div id="templateBpx" class="templateBox" :class="toggleClose" v-if="isIosChromeTmp"><span @touchstart="slideUpTemplate" class="templateBtn"></span>
    <div class="wrap">
      <div class="templateBody">
        <div class="swiper-container">
            <div class="swiper-wrapper">
              <div class="swiper-slide templateItems">
                <dl>
                  <dt>写真が素敵（例文1）</dt>
                  <dd>はじめまして！まりかといいます(^_^)プロフィールを見て素敵な方だとおもいました〜♪
                  よろしくおねがいします！仲良くしてくださいね♪</dd>
                </dl>
              </div>
              <div class="swiper-slide templateItems">
                <dl>
                  <dt>写真が素敵（例文2）</dt>
                  <dd>はじめまして！まりかといいます(^_^)プロフィールを見て素敵な方だとおもいました〜♪
                  よろしくおねがいします！仲良くしてくださいね♪</dd>
                </dl>
              </div>
              <div class="swiper-slide templateItems">
                <dl>
                  <dt>写真が素敵（例文3）</dt>
                  <dd>はじめまして！まりかといいます(^_^)プロフィールを見て素敵な方だとおもいました〜♪
                  よろしくおねがいします！仲良くしてくださいね♪</dd>
                </dl>
              </div>
            </div>
            <div class="swiper-pagination templatePaginate"></div>
        </div>
      </div>
      <div class="insertBtn"><a href="">このメッセージを使う</a></div>
    </div>
  </div>
  <div  class="messageBox" :class="setIsRiseup" v-if="isIosChrome">
    chrome
  </div>
  <div id="messageBox" class="messageBox" :class="setIsRiseup" v-else>
    <div class="special"><span class="icon"></span></div>
    <div class="input"><div class="textareaWrap"><computed-textarea></computed-textarea></div></div>
    <div class="send"><input type="submit" value="送信"></div>
  </div>
</div>


</div><!--/container-->

<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.6/js/swiper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.6/dist/vue.js"></script>
<script src="./js/smoothscroll.min.js"></script>
<script src="./js/photoswipe.js" charset="utf-8"></script>
<script src="./js/photoswipe-ui-default.js" charset="utf-8"></script>
<script src="./js/photoswipe-simplify.js" charset="utf-8"></script>
<script>
'use strict';

photoswipeSimplify.init({
  history: false,
    focus: false,
});

var ua = window.navigator.userAgent.toLowerCase();
var is_ios_safari = (ua.indexOf('iphone') !== -1 && ua.indexOf('safari') !== -1 && ua.indexOf('crios') === -1 && ua.indexOf('edge') === -1);
var is_ios_chrome = (ua.indexOf('iphone') !== -1 && ua.indexOf('safari') !== -1 && ua.indexOf('crios') !== -1 && ua.indexOf('edge') === -1);


function _setIosSafari() {
  const html = document.querySelector('html');
  const body = document.body;
  //const ua = window.navigator.userAgent.toLowerCase();
  //const is_ios_safari = (ua.indexOf('iphone') !== -1 && ua.indexOf('safari') !== -1 && ua.indexOf('crios') === -1 && ua.indexOf('edge') === -1);
  const _setHeight = function() {
    const winH = window.innerHeight;
    container.style.height = winH + 'px';
    main.style.height = winH + 'px';
  }
  if (is_ios_safari){
    _setHeight();
  } else {
    body.classList.remove('is_ios_safari');
    body.classList.add('is_else_browser');
  }
}
_setIosSafari()

function _menu() {
  new Vue({
    el: '#header',
    data: {
      changeOpen : {
        open: false
      }
    },
    mounted() {
      document.addEventListener('touchstart',this.fadeInMenu);
    },
    methods: {
      fadeInMenu(e) {
        const target = e.target;
        const is_id_show = (target.closest('#show') != null);
        const is_id_menu = (target.closest('#menu') != null);
        if ( ! (is_id_show || is_id_menu) ) {
          this.changeOpen.open = false;
        } else {
          this.changeOpen.open =! this.changeOpen.open;
        }
      }
    }
  });
}
_menu()

Vue.directive('scroll', {
  inserted: function(el, binding) {
    const element = is_ios_safari ? main : window;
    let f = function(evt) {
      if (binding.value(evt, el)) {
        element.removeEventListener('scroll', f)
      }
    }
    element.addEventListener('scroll',f)
  }
})
Vue.component('distance-circle',{
  props: ['last'],
  template: `
    <svg class="distanceCircle"><circle></circle></svg>
  `,
  mounted() {},
  methods: {
    setCircleAnimation(){
      const v = this.$el.getBoundingClientRect();
      const l = this.$props.last;
      const rect_width = v.width;
      const pi = Math.round(rect_width * 3.14);
      const arc_calc = (pi / 24) * (24 - l);
      const arc = Math.round(arc_calc);
      const style = document.createElement('style');
      style.innerText =
      '#bbsStatusWrap .statusBody .distance .distanceCircle circle{animation: circle 1s forwards}' +
      '@keyframes circle{0% {stroke:#ccc;stroke-dasharray:0 ' + pi + '}100% {stroke:#ccc;stroke-dasharray:' + arc + ' ' + pi + '}}';
      const head = document.getElementsByTagName('head');
      head.item(0).appendChild(style);
    },
  }
})
new Vue({
  el: '#bbsStatusWrap',
  data: {
    bbsWrapHeight: document.querySelector('#bbsStatusWrap .statusBody').getBoundingClientRect().height,
    drawerHeight: Math.ceil(25.1 * 3.75),
    count: '0'
  },
  methods: {
    reachScroll(evt,el) {
      if(this.count < 1) {
        const bbsWrapTop = document.querySelector('#bbsStatusWrap .statusBody').getBoundingClientRect().top;
        const windowH = window.innerHeight;
        const scroll_elm = is_ios_safari ? evt.target : document.body;
        const scroll = scroll_elm.scrollTop;
        const calc = bbsWrapTop + this.bbsWrapHeight + scroll + this.drawerHeight - windowH;
        const position = Math.floor(calc);
        if (scroll >= position) {
          this.$refs.circle.setCircleAnimation();
          this.count =+ 1;
        }
      } else {
        return;
      }
    }
  }
})

function _fixedDrawer() {
  Vue.component('computed-textarea',{
    template: '<textarea :rows="rows" placeholder="メッセージしてみよう" v-model="value"></textarea>',
    data() {
      return {
        value: '',
      }
    },
    computed: {
      rows() {
        let num = this.value.split('\n').length;
        return (num > 3) ? 3 : num;
      },
    },
    methods: {}
  })
  new Vue({
    el: '#fixedDrawer',
    data: {
      changeSetRiseup: {
        hidden: true,
        riseup: false
      },
      isIosTransrate: {
        is_ios: false
      },
      toggleClose: {
        close: true
      },
      setIsRiseup: {
        is_riseup: true
      },
      inputCheckIos: false
    },
    mounted() {
      this.$nextTick(function(){
        this.changeSetRiseup.riseup = true;
        this.animationEnd();
      });
      this.setSwiper();
    },
    computed: {
      isIosChrome() {
        return is_ios_chrome;
      },
      isIosChromeTmp() {
        return !is_ios_chrome;
      }
    },
    methods: {
      animationEnd() {
        this.$el.addEventListener('animationend',function(){
          this.changeSetRiseup.hidden = false;
          this.changeSetRiseup.riseup = false;
          this.setIsRiseup.is_riseup = false;
        }.bind(this));
      },
      slideUpTemplate() {
        this.toggleClose.close =! this.toggleClose.close
      },
      setSwiper() {
        new Swiper('.swiper-container',{
          pagination: {
            el: '.swiper-pagination'
          }
        })
      },
    }
  });
}
_fixedDrawer()
</script>
</body>
</html>
